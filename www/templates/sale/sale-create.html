<ion-view view-title="Sale Create">
  <ion-nav-buttons side="right">
    <button class="button icon ion-person-add" ng-click="customerOpenModal(false)"></button>
  </ion-nav-buttons>
  <ion-content padding="true">
		<form name="formCreateSale" ng-submit="create(cart)" class="list">

      <!-- SELECT CUSTOMER -->
      <div class="item item-input item-select" ng-click="customerOpenModal(true)">
        <span class="input-label">Customer</span>
        <p>{{sale.customerName}}</p>
      </div>

      <!-- PRODUCTS -->
      <label class="item item-input item-select item-divider" ng-click="productOpenModal()">
        <span class="input-label">Products</span>
      </label>
      <div class="item row" ng-repeat="item in cart.products">
        <div class="col col-40">
          <div>
            {{item.item.extra.product_type_name}}
          </div>
          <div>
            {{item.item.name}}
          </div>
          <div>
            {{item.item.extra.brand_name}}
          </div>
        </div>
        <div class="col col-15 center" ng-if="item.item.quantity > 0 && item.item.qtySelected < item.item.quantity">
          <button type="button" class="button icon ion-plus-circled button-light sale-button-remove" ng-click="addItem(item.item,null)"></button>
        </div>
        <div class="col col-15 center" ng-if="item.item.qtySelected > 0">
          <button type="button" class="button icon ion-minus-circled button-light sale-button-add" ng-click="removeItem(item.item,null)"></button>
        </div>
        <div class="col">
          <span class="badge badge-positive sale-qty-acum">{{item.qty}}</span>
        </div>
      </div>

      <!-- SERVICES -->
      <label class="item item-input item-select item-divider" ng-click="serviceOpenModal()">
        <span class="input-label">Services</span>
      </label>
      <div class=" item row" ng-repeat="item in cart.services">
        <div class="col col-40">
          {{item.item.name}}
        </div>
        <div class="col col-15 center">
          <button type="button" class="button icon ion-plus-circled button-light" ng-click="addItem(null,item.item)"></button>
        </div>
        <div class="col col-15 center" ng-if="item.item.qtySelected > 0">
          <button type="button" class="button icon ion-minus-circled button-light" ng-click="removeItem(null,item.item)"></button>
        </div>
        <div class="col">
          <span class="badge badge-positive">{{item.item.qtySelected}}</span>
        </div>
      </div>

      <div class="spacer" style="height:20px;"></div>

      <!-- SUBTOTAL -->
      <div class="row item item-positive">
        <div class="col col-75">
          SubTotal
        </div>
        <div class="col col-25">
          <div ng-if="cart.discount >= 0 && cart.discount <= 100">
            {{ cart.totalCart - (cart.totalCart * cart.discount) / 100 | currency : $ : 0 }}
          </div>
          <div ng-if="cart.discount < 0 || cart.discount > 100">
            $ 0
          </div>
        </div>
      </div>

      <!-- DISCOUNT -->
      <div class="row item item-light">
        <div class="col col-50">
          Discount
        </div>
        <div class="col col-25" ng-if="toggleCashPercent">
          <div ng-if="cart.totalCart > 0 && cart.discount < 100 && cart.discount > 0">
            {{cart.discount | currency : '' : 2}} %
          </div>
        </div>
        <div class="col col-25" ng-if="!toggleCashPercent">
          <div ng-if="cart.totalCart > 0 && cart.discountValue < cart.totalCart && cart.discountValue > 0">
            {{ (cart.discountValue * 100) / cart.totalCart | currency : '' : 2 }} %
          </div>
          <div ng-if="cart.totalCart == 0">
            0.00 %
          </div>
        </div>
        <div class="col col-25">
          <div ng-if="toggleCashPercent">
            <div ng-if="cart.totalCart > 0 && cart.discount >= 0 && cart.discount <= 100">
              {{ (cart.totalCart * cart.discount) / 100 | currency : $ : 0 }}
            </div>
            <div ng-if="cart.discount < 0 || cart.discount > 100">
              $ 0
            </div>
          </div>
          <div ng-if="!toggleCashPercent">
            <div ng-if="cart.totalCart > 0 && cart.discountValue < 100 && cart.discountValue > 0">
              {{ cart.discountValue | currency : $ : 0 }}
            </div>
            <div ng-if="cart.totalCart == 0">
              $ 0
            </div>
          </div>
        </div>
      </div>

      <!-- CASH OR PERCENT DISCOUNT -->
      <div class="row item offPadding-bottom">
        <div class="col col-20">
          <button ng-if="toggleCashPercent" class="button icon ion-percent">%</button>
          <button ng-if="!toggleCashPercent" class="button icon ion-social-usd"></button>
        </div>
        <div class="col col-60">
          <label ng-if="toggleCashPercent" class="item-input">
            <input type="text" ng-model="cart.discount">
          </label>
          <label ng-if="!toggleCashPercent" class="item-input">
            <input type="text" ng-model="cart.discountValue">
          </label>
        </div>
        <div class="col col-20">
          <label class="toggle toggle-sales">
            <input type="checkbox" ng-model="toggleCashPercent" ng-change="cashPercentToggle()">
            <div class="track">
              <div class="handle"></div>
            </div>
          </label>
        </div>
      </div>

      <div class="spacer" style="height:20px;"></div>

      <div ng-if="showCashPoints">
        <!-- POINTS -->
        <div class="row item item-light">
          <div class="col col-50">
            Points
          </div>
          <div class="col col-25">
            <!-- {{cart.points}} -->
          </div>
          <div class="col col-25">
            {{ cart.points | currency : $ : 0 }}
          </div>
        </div>

        <!-- RANGE POINT CRM -->
        <div class="item range range-balanced">
          <i>0</i>
          <input type="range" name="points" min="0.00" max="{{maxRangePoints}}" value="0" ng-model="cart.points">
          <i>{{points}}</i>
        </div>
      </div>

      <div class="spacer" style="height:20px;"></div>

      <!-- TAX -->
      <div class="row item item-light">
        <div class="col col-75">
          Tax
        </div>
        <div class="col col-25">
          {{ cart.tax | currency : $ : 0 }}
        </div>
      </div>

      <!-- TOTAL -->
      <div class="row item item-positive">
        <div class="col col-75">
          Total
        </div>
        <div class="col col-25">
          <div ng-if="cart.discount >= 0 && cart.discount <= 100">
            {{ cart.totalCart - (cart.totalCart * cart.discount) / 100 + cart.tax - cart.points | currency : $ : 0 }}
          </div>
          <div ng-if="cart.discount < 0 || cart.discount > 100">
            $ 0
          </div>
        </div>
      </div>

      <!-- SUBMIT FORM -->
      <button type="submit" class="button button-balanced button-block button-outline icon-left ion-android-add">Create</button>
      <button type="button" ng-click="cancel()" class="button button-positive button-block button-outline icon-left ion-android-arrow-back">Cancel</button>
    </form>
    <!-- <created-account-crm></created-account-crm> -->
	</ion-content>
</ion-view>